#!/usr/bin/env python

import sys
import os
import os.path
import datetime as dt
import time

from posttroll.publisher import NoisyPublisher
from posttroll.message import Message
from trollsift import parse

def send_message(topic, info, message_type):
    '''Send message with the given topic and info'''
    pub_ = NoisyPublisher("dummy_sender", 0, topic)
    pub = pub_.start()
    time.sleep(2)
    msg = Message(topic, message_type, info)
    print "Sending message: %s" % str(msg)
    pub.send(str(msg))
    pub_.stop()

def main():
    '''Main.'''

    topic = "/AAPP/1B"

    info_dicts = [{"origin": "157.249.16.170:9060",
                   "uid": "hrpt_metop01_20170307_0638_23180.l1b",
                   "format": "AAPP", "process_time": "2017-03-07T06:41:47",
                   "start_time": "2017-03-07T06:38:00", "compress": ".bz2",
                   "uri": "file://satproc2.met.no/data/trollduction/data/aapp-outdir-ears/metop01_20170307_0638_23180/hrpt_metop01_20170307_0638_23180.l1b",
                   "filename": "hrpt_metop01_20170307_0638_23180.l1b",
                   "platform_name": "Metop-B", "station": "oslo",
                   "end_time": "2017-03-07T06:55:00", "env": "ears", "type": "Binary",
                   "pass_key": "af242ed372824ae51dc4b338e6bdbd02",
                   "sensor": "avhrr/3",
                   "collection_area_id": "eurol", "orbit_number": 23180, "data_processing_level": "1B"},]    

    message_type = 'file'

    topic = "/GLOBAL/METOP/AMV/2d"
    info_dicts = [{"origin": "157.249.16.170:9062", "collection_area_id": "amv_collection", "orbit_number": "23610", "collection": [{"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112203_23609_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:22:03", "end_time": "2017-04-06T11:25:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112203_23609_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112503_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:25:03", "end_time": "2017-04-06T11:28:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112503_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112803_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:28:03", "end_time": "2017-04-06T11:31:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406112803_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113103_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:31:03", "end_time": "2017-04-06T11:34:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113103_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113403_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:34:03", "end_time": "2017-04-06T11:37:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113403_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113703_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:37:03", "end_time": "2017-04-06T11:40:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406113703_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406114003_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T11:40:03", "end_time": "2017-04-06T11:43:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406114003_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406123403_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T12:34:03", "end_time": "2017-04-06T12:37:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406123403_23610_eps_o_amv_l2d.bin"}, {"uid": "W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406123703_23610_eps_o_amv_l2d.bin", "start_time": "2017-04-06T12:37:03", "end_time": "2017-04-06T12:40:03", "uri": "file:///data/pytroll/global-metop-amv-l2d/W_XX-EUMETSAT-Darmstadt,SOUNDING+SATELLITE,METOPB+AVHRR_C_EUMP_20170406123703_23610_eps_o_amv_l2d.bin"}], "platform_name": "Metop-B", "end_time": "2017-04-06T12:40:03", "sensor": "amv", "start_time": "2017-04-06T11:25:03"},]

    message_type = 'collection'
    topic = "/EARS/VIIRS/SDR_compact"
    info_dicts = [{"sensor": ["viirs"], "end_decimal": 7, "stream": "eumetcast", "format": "SDR_compact", "orig_platform_name": "npp", "start_time": "2017-05-30T09:24:02", "variant": "EARS", "orbit_number": 28957, "collection": [{"start_time": "2017-05-30T09:24:02", "end_time": "2017-05-30T09:25:24", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0924020_e0925247_b28957_c20170530093222627160_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0924020_e0925247_b28957_c20170530093222627160_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:25:25", "end_time": "2017-05-30T09:26:50", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0925259_e0926501_b28957_c20170530093224904180_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0925259_e0926501_b28957_c20170530093224904180_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:26:51", "end_time": "2017-05-30T09:28:15", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0926513_e0928155_b28957_c20170530093627220124_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0926513_e0928155_b28957_c20170530093627220124_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:28:16", "end_time": "2017-05-30T09:29:40", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0928167_e0929409_b28957_c20170530093629449126_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0928167_e0929409_b28957_c20170530093629449126_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:29:42", "end_time": "2017-05-30T09:31:06", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0929421_e0931063_b28957_c20170530093936232123_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0929421_e0931063_b28957_c20170530093936232123_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:31:07", "end_time": "2017-05-30T09:32:31", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0931075_e0932317_b28957_c20170530093938761138_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0931075_e0932317_b28957_c20170530093938761138_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:32:32", "end_time": "2017-05-30T09:33:57", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0932329_e0933571_b28957_c20170530093941314179_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0932329_e0933571_b28957_c20170530093941314179_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:33:58", "end_time": "2017-05-30T09:35:22", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0933583_e0935225_b28957_c20170530094342754170_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0933583_e0935225_b28957_c20170530094342754170_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:35:23", "end_time": "2017-05-30T09:36:47", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0935237_e0936479_b28957_c20170530094211073126_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0935237_e0936479_b28957_c20170530094211073126_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:36:49", "end_time": "2017-05-30T09:38:13", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0936492_e0938133_b28957_c20170530094452662140_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0936492_e0938133_b28957_c20170530094452662140_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:38:14", "end_time": "2017-05-30T09:39:38", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0938146_e0939387_b28957_c20170530094455122130_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0938146_e0939387_b28957_c20170530094455122130_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:39:40", "end_time": "2017-05-30T09:41:04", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0939400_e0941041_b28957_c20170530094945662130_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0939400_e0941041_b28957_c20170530094945662130_eum_ops.h5"}]}, {"start_time": "2017-05-30T09:41:05", "end_time": "2017-05-30T09:42:29", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170530_t0941054_e0942295_b28957_c20170530094948051155_eum_ops.h5", "uid": "SVMC_npp_d20170530_t0941054_e0942295_b28957_c20170530094948051155_eum_ops.h5"}]}], "start_decimal": 0, "proctime": "20170530093222627160", "type": "HDF5", "collection_area_id": "ears_high_res", "tle_platform_name": "SUOMI NPP", "platform_name": "npp", "end_time": "2017-05-30T09:42:29", "data_processing_level": "1B"},]

    info_dicts = [{"sensor": ["viirs"], "end_decimal": 1, "stream": "eumetcast", "format": "SDR_compact", "orig_platform_name": "npp", "start_time": "2017-05-31T04:04:56", "variant": "EARS", "orbit_number": 28968, "collection": [{"start_time": "2017-05-31T04:04:56", "end_time": "2017-05-31T04:06:21", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0404567_e0406211_b28968_c20170531041301922143_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0404567_e0406211_b28968_c20170531041301922143_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:06:22", "end_time": "2017-05-31T04:07:46", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0406223_e0407465_b28968_c20170531041304337123_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0406223_e0407465_b28968_c20170531041304337123_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:07:47", "end_time": "2017-05-31T04:09:11", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0407477_e0409119_b28968_c20170531041656577123_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0407477_e0409119_b28968_c20170531041656577123_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:09:13", "end_time": "2017-05-31T04:10:37", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0409131_e0410373_b28968_c20170531041659199138_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0409131_e0410373_b28968_c20170531041659199138_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:10:38", "end_time": "2017-05-31T04:12:02", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0410385_e0412027_b28968_c20170531041941475148_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0410385_e0412027_b28968_c20170531041941475148_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:12:03", "end_time": "2017-05-31T04:13:28", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0412039_e0413281_b28968_c20170531041943953129_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0412039_e0413281_b28968_c20170531041943953129_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:13:29", "end_time": "2017-05-31T04:14:53", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0413293_e0414535_b28968_c20170531042256080129_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0413293_e0414535_b28968_c20170531042256080129_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:14:54", "end_time": "2017-05-31T04:16:18", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0414547_e0416189_b28968_c20170531042258374117_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0414547_e0416189_b28968_c20170531042258374117_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:16:20", "end_time": "2017-05-31T04:17:44", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0416201_e0417443_b28968_c20170531042308008129_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0416201_e0417443_b28968_c20170531042308008129_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:17:45", "end_time": "2017-05-31T04:19:09", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0417455_e0419097_b28968_c20170531042700151151_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0417455_e0419097_b28968_c20170531042700151151_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:19:10", "end_time": "2017-05-31T04:20:35", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0419109_e0420351_b28968_c20170531042656000111_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0419109_e0420351_b28968_c20170531042656000111_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0419109_e0420351_b28968_c20170531042702381137_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0419109_e0420351_b28968_c20170531042702381137_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:20:36", "end_time": "2017-05-31T04:22:00", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0420363_e0422005_b28968_c20170531043001000016_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0420363_e0422005_b28968_c20170531043001000016_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0420363_e0422005_b28968_c20170531043011764127_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0420363_e0422005_b28968_c20170531043011764127_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:22:01", "end_time": "2017-05-31T04:23:25", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0422017_e0423259_b28968_c20170531043005000442_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0422017_e0423259_b28968_c20170531043005000442_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0422017_e0423259_b28968_c20170531043014024126_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0422017_e0423259_b28968_c20170531043014024126_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:23:27", "end_time": "2017-05-31T04:24:51", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0423271_e0424513_b28968_c20170531042941000615_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0423271_e0424513_b28968_c20170531042941000615_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0423271_e0424513_b28968_c20170531042947786130_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0423271_e0424513_b28968_c20170531042947786130_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:24:52", "end_time": "2017-05-31T04:26:16", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0424526_e0426167_b28968_c20170531043321000465_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0424526_e0426167_b28968_c20170531043321000465_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0424526_e0426167_b28968_c20170531043325068147_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0424526_e0426167_b28968_c20170531043325068147_eum_ops.h5"}]}, {"start_time": "2017-05-31T04:26:18", "end_time": "2017-05-31T04:27:42", "dataset": [{"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-DNB-EARS-uncompressed/SVDNBC_npp_d20170531_t0426180_e0427421_b28968_c20170531043330000785_eum_ops.h5", "uid": "SVDNBC_npp_d20170531_t0426180_e0427421_b28968_c20170531043330000785_eum_ops.h5"}, {"uri": "/data/MET/eumetcast-incomming/NPP-VIIRS-M-EARS-uncompressed/SVMC_npp_d20170531_t0426180_e0427421_b28968_c20170531043327550137_eum_ops.h5", "uid": "SVMC_npp_d20170531_t0426180_e0427421_b28968_c20170531043327550137_eum_ops.h5"}]}], "start_decimal": 7, "proctime": "20170531041301922143", "type": "HDF5", "collection_area_id": "ears_high_res", "tle_platform_name": "SUOMI NPP", "platform_name": "npp", "end_time": "2017-05-31T04:27:42", "data_processing_level": "1B"},]

    for info_dict in info_dicts:
        send_message(topic, info_dict, message_type)

if __name__ == "__main__":
    main()
